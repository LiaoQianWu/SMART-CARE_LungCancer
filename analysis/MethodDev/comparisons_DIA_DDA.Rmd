---
title: "Comparisons between DIA and DDA proteomics datasets"
author: "Qian-Wu Liao"
output:
  workflowr::wflow_html:
    toc: true
    toc_float: true
    code_folding: hide
---

<font size='4'> Description: Compare DIA and DDA Plasma and Tissue Proteomics generated
by AG Krijgsveld. Basically, correlations of common features between DIA and DDA
Proteomics were computed to see data reproducibility using different data acquisition
methods.\

Update: Compare DIA Tissue Proteomics generated by AG Klingmüller with aforementioned
DIA and DDA Tissue Proteomics from AG Krijgsveld. In addition, significant cancer
recurrence-related proteins from each dataset are also summarized.\

Update: Compare New DIA Plasma and Tissue Proteomics from AG Krijgsveld with all
aforementioned datasets. Old DIA Tissue Proteomics from AG Krijgsveld may have
something wrong (bad data quality)! </font>

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, fig.height = 8, fig.width = 10, warning = F)
knitr::opts_knit$set(root.dir = '/Users/qianwu/Desktop/SMART-CARE_LungCancer_MethodDev')
```

Load libraries
```{r library loading, message = F}
library(SummarizedExperiment)
library(ggrepel)
library(igraph)
library(ggraph)
library(tidyverse)
# Load user-defined functions
source('./code/misc.R')

# Set plot theme
th <- theme_bw(base_size = 15) +
  theme(axis.title = element_text(face = 'bold'),
        axis.text = element_text(face = 'bold'),
        axis.ticks = element_line(linewidth = 0.8),
        legend.text = element_text(size = 15))
```

```{r}
calcFeatCorr <- function(data1, data2, show_nFeats = F) {
  #' Systematically compute feature correlations between two PROTEOMICS (for now) datasets
  #' 
  #' Parameters
  #' data1, data2: SummarizedExperiment objects that contain data matrices
  #' 
  #' Return
  #' corrRes: A table of correlations of overlapped features between two datasets
  
  # Extract data matrix
  dat1 <- SummarizedExperiment::assay(data1)
  dat2 <- SummarizedExperiment::assay(data2)
  
  # Make two matrices share same sample and feature spaces and in same row and column order
  # Keep only common samples
  commonSmps <- intersect(colnames(dat1), colnames(dat2))
  dat1 <- dat1[, commonSmps]
  dat2 <- dat2[, commonSmps]
  # Keep only common features
  # Select first protein as representative if there are more than one
  rownames(dat1) <- stringr::str_remove(rownames(dat1), ';.*')
  rownames(dat2) <- stringr::str_remove(rownames(dat2), ';.*')
  commonFeats <- intersect(rownames(dat1), rownames(dat2))
  dat1 <- dat1[commonFeats,]
  dat2 <- dat2[commonFeats,]
  if (show_nFeats) {
    cat('Features in data1: ', nrow(data1), '\n', 'Features in data2: ', nrow(data2), '\n',
        'Features in common: ', length(commonFeats), sep = '')
  }
  
  # Compute feature correlations between two proteomics datasets
  # Do sanity check
  if (identical(rownames(dat1), rownames(dat2)) &
      identical(colnames(dat1), colnames(dat2))) {
    corrs <- sapply(seq_len(nrow(dat1)), function(i) {
      corr <- cor.test(dat1[i,], dat2[i,], method = 'pearson', use = "pairwise.complete.obs")
      corr$estimate
    })
    corrRes <- data.frame(Feature = rownames(dat1), Correlation = corrs) %>%
      dplyr::arrange(Correlation)
  }
  
  return(corrRes)
}

doFeatAssoTest <- function(data, condition) {
  #' Conduct univariate association test between each feature and CANCER RECURRENCE (for now)
  #' 
  #' Parameters
  #' data: A SummarizedExperiment object that contains the data matrix and metadata
  #' condition: A character specifying the sample metadata to split the dataset
  #' 
  #' Return
  #' assoTestRes: A table of feature significance test results
  
  # Subset samples
  subsetIdx <- which(colData(data)$Condition == condition)
  datSub <- data[, subsetIdx]
  datMat <- SummarizedExperiment::assay(datSub)
  
  if (all(complete.cases(datMat))) {
    # Perform analysis
    soaRes <- doSOA(datSub, meta_var = 'Recurrence')
    assoTestRes <- soaRes$tFeatRes %>%
      dplyr::select(Var1, pVal) %>%
      dplyr::rename(Feature = Var1)
  } else {
    smpAnno <- tibble::as_tibble(colData(datSub), rownames = 'Sample')
    # Perform analysis
    # Fit linear probabilistic dropout model to normalized data
    fit <- proDA::proDA(datMat, design = ~ smpAnno$Recurrence)
    assoTestRes <- proDA::test_diff(fit,
                                 contrast = Intercept + `smpAnno$RecurrenceYes` - Intercept,
                                 sort_by = 'pval') %>%
      dplyr::select(name, pval) %>%
      dplyr::rename(Feature = name, pVal = pval)
  }
  
  return(assoTestRes)
}

combineFeatAsso <- function(data1, data2, name1, name2, condition, prot_gene_tbl, alpha = 0.05) {
  #' Conduct univariate association tests between features and CANCER RECURRENCE (for now)
  #' and combine and tidy up results and information into a table for making plots
  #' 
  #' Parameters
  #' data1, data2: SummarizedExperiment objects that contain the data matrices and metadata
  #' name1, name2: Characters indicating the dataset names in the plot legend
  #' condition: A character specifying the sample metadata to split the dataset
  #' prot_gene_tbl: A table containing proteins and their encoding genes for plot
  #' labeling. The column for proteins should be named 'Proteins' and for genes
  #' should be named 'Genes'. Furthermore, only the first protein and gene should
  #' be kept if there are more than one
  #' #' alpha: A numeric value specifying the significance level for hypothesis testing
  #' 
  #' Return:
  #' combinedAssoTestRes: A table containing association test results, labeling
  #' information, etc. for making plots
  
  # Extract common features between two datasets
  # Select first protein as representative if there are more than one
  commonFeats <- intersect(stringr::str_remove(rownames(data1), ';.*'),
                           stringr::str_remove(rownames(data2), ';.*'))
  
  # Compute associations between features and cancer recurrence and tidy up association test results
  assoTestRes_dat1 <- doFeatAssoTest(data1, condition = condition) %>%
    dplyr::mutate(Feature = stringr::str_remove(Feature, ';.*'),
                  Sig_dat1 = dplyr::case_when(pVal <= alpha ~ 'Yes',
                                              pVal > alpha ~ 'No')) %>%
    dplyr::filter(Feature %in% commonFeats) %>%
    dplyr::rename(pVal_dat1 = pVal)
  assoTestRes_dat2 <- doFeatAssoTest(data2, condition = condition) %>%
    dplyr::mutate(Feature = stringr::str_remove(Feature, ';.*'),
                  Sig_dat2 = dplyr::case_when(pVal <= alpha ~ 'Yes',
                                              pVal > alpha ~ 'No')) %>%
    dplyr::filter(Feature %in% commonFeats) %>%
    dplyr::rename(pVal_dat2 = pVal)
  
  # Combine association test results into a table and prepare color and label information
  combinedAssoTestRes <- dplyr::left_join(assoTestRes_dat1, assoTestRes_dat2, by = 'Feature') %>%
    dplyr::mutate(Significance = dplyr::case_when(Sig_dat1 == 'Yes' & Sig_dat2 == 'Yes' ~ 'Sig. in Both',
                                                  Sig_dat1 == 'Yes' & Sig_dat2 == 'No' ~ paste('Sig. in', name1),
                                                  Sig_dat1 == 'No' & Sig_dat2 == 'Yes' ~ paste('Sig. in', name2),
                                                  Sig_dat1 == 'No' & Sig_dat2 == 'No' ~ 'Not sig.'),
                  Gene = plyr::mapvalues(Feature,
                                         from = prot_gene_tbl$Proteins,
                                         to = prot_gene_tbl$Genes,
                                         warn_missing = F),
                  Label = dplyr::case_when(Significance == 'Sig. in Both' ~ Gene))
  # Reorder points in graph
  significance <- combinedAssoTestRes$Significance
  combinedAssoTestRes <- combinedAssoTestRes[c(which(significance == 'Not sig.'),
                                               which(significance == 'Sig. in Both'),
                                               which(significance == paste('Sig. in', name1)),
                                               which(significance == paste('Sig. in', name2))),]
  
  return(combinedAssoTestRes)
}

findOverlapSigFeats <- function(DIA_data1, DIA_data2, DDA_data = NULL, condition,
                                prot_gene_tbl, alpha = 0.05) {
  #' Extract overlaps of significant features across datasets
  #' 
  #' Parameters
  #' DIA_data1, DIA_data2: SummarizedExperiment objects that contain the data matrices and metadata
  #' DDA_data: An SE object containing the data matrix and metadata, which is used
  #' as an extra layer of evidence to support found significant features. Defualt is NULL
  #' condition: A character specifying the sample metadata to split the dataset
  #' prot_gene_tbl: A table containing proteins and their encoding genes for plot
  #' labeling. The column for proteins should be named 'Proteins' and for genes
  #' should be named 'Genes'. Furthermore, only the first protein and gene should
  #' be kept if there are more than one
  #' alpha: A numeric value specifying the significance level for hypothesis testing
  #' 
  #' Return
  #' A list containing the following components:
  #' overlapFeatTab: A table containing summarized results of significance tests
  #' across datasets. The columns of 'pVal1' and 'pVal2' hold feature significance
  #' from input data1 and data2. Score is the product of -log10(pVal1) and -log10(pVal2)
  #' sigFeatTab1, sigFeatTab2: Summarized information of common significant features
  #' and needed sample and feature metadata
  
  # Extract common features between two datasets
  # Select first protein as representative if there are more than one
  cmnFeats<- intersect(stringr::str_remove(rownames(DIA_data1), ';.*'),
                       stringr::str_remove(rownames(DIA_data2), ';.*'))
  
  # Do association test between each feature and cancer recurrence and organize
  # significant features from each dataset
  sigFeats1_DIA <- doFeatAssoTest(DIA_data1, condition = condition) %>%
    dplyr::mutate(Feature = stringr::str_remove(Feature, ';.*'),
                  Occurrence = dplyr::case_when(pVal <= alpha ~ 1,
                                                pVal > alpha ~ 0)) %>%
    dplyr::filter(Feature %in% cmnFeats)
  sigFeats2_DIA <- doFeatAssoTest(DIA_data2, condition = condition) %>%
    dplyr::mutate(Feature = stringr::str_remove(Feature, ';.*'),
                  Occurrence = dplyr::case_when(pVal <= alpha ~ 1,
                                                pVal > alpha ~ 0)) %>%
    dplyr::filter(Feature %in% cmnFeats)
  
  # Summarize all information and pinpoint most promising recurrence-related features
  summSigFeats <- dplyr::left_join(sigFeats1_DIA, sigFeats2_DIA, by = 'Feature') %>%
    dplyr::mutate(Occurrence = Occurrence.x + Occurrence.y) %>%
    dplyr::filter(Occurrence == 2) %>%
    # dplyr::mutate(Score = ((-log10(pVal.x))+(-log10(pVal.y)))/2) %>%
    dplyr::mutate(Score = (-log10(pVal.x) * -log10(pVal.y))) %>%
    dplyr::arrange(dplyr::desc(Score)) %>%
    dplyr::mutate(Gene = plyr::mapvalues(Feature,
                                         from = prot_gene_tbl$Proteins,
                                         to = prot_gene_tbl$Genes,
                                         warn_missing = F),
                  Gene = factor(Gene, levels = Gene)) %>%
    dplyr::rename(Protein = Feature, pVal1 = pVal.x, pVal2 = pVal.y) %>%
    dplyr::select(-c(Occurrence, Occurrence.x, Occurrence.y))
  
  # Add extra layer of evidence if provided
  if (!is.null(DDA_data)) {
    sigFeats_DDA <- doFeatAssoTest(DDA_data, condition = condition) %>%
      dplyr::filter(pVal <= alpha) %>%
      dplyr::mutate(Feature = stringr::str_remove(Feature, ';.*')) %>%
      dplyr::pull(Feature)
    summSigFeats <- dplyr::mutate(summSigFeats,
                                  inDDA = dplyr::case_when(Protein %in% sigFeats_DDA ~ 'Yes',
                                                           !(Protein %in% sigFeats_DDA) ~ 'No'))
  }
  
  # Retrieve abundances of overlapped significant features from each dataset and
  # combine all needed sample and feature information into a table
  # Prepare patient recurrence information
  recurInfo <- tibble::as_tibble(colData(DDA_data), rownames = 'Sample') %>%
    dplyr::select(Sample, Recurrence)
  # Tidy up all needed information
  DIA_dataSub1 <- DIA_data1[, which(colData(DIA_data1)$Condition == condition)]
  rownames(DIA_dataSub1) <- stringr::str_remove(rownames(DIA_dataSub1), ';.*')
  sigFeats1 <- t(SummarizedExperiment::assay(DIA_dataSub1)) %>%
    tibble::as_tibble(rownames = 'Sample') %>%
    dplyr::select(c(Sample, summSigFeats$Protein)) %>%
    tidyr::pivot_longer(cols = -'Sample', names_to = 'Protein', values_to = 'Abundance') %>%
    dplyr::left_join(summSigFeats[, c('Protein', 'Gene', 'pVal1', 'inDDA')], by = 'Protein') %>%
    dplyr::left_join(recurInfo, by = 'Sample') %>%
    dplyr::mutate(Gene = paste0(Gene, '\n(p = ', round(pVal1, 4), ')'),
                  Gene = dplyr::case_when(inDDA == 'Yes' ~ paste0('*', Gene),
                                          inDDA == 'No' ~ Gene),
                  Gene = factor(Gene, levels = unique(Gene)))
  DIA_dataSub2 <- DIA_data2[, which(colData(DIA_data2)$Condition == condition)]
  rownames(DIA_dataSub2) <- stringr::str_remove(rownames(DIA_dataSub2), ';.*')
  sigFeats2 <- t(SummarizedExperiment::assay(DIA_dataSub2)) %>%
    tibble::as_tibble(rownames = 'Sample') %>%
    dplyr::select(c(Sample, summSigFeats$Protein)) %>%
    tidyr::pivot_longer(cols = -'Sample', names_to = 'Protein', values_to = 'Abundance') %>%
    dplyr::left_join(summSigFeats[, c('Protein', 'Gene', 'pVal2', 'inDDA')], by = 'Protein') %>%
    dplyr::left_join(recurInfo, by = 'Sample') %>%
    dplyr::mutate(Gene = paste0(Gene, '\n(p = ', round(pVal2, 4), ')'),
                  Gene = dplyr::case_when(inDDA == 'Yes' ~ paste0('*', Gene),
                                          inDDA == 'No' ~ Gene),
                  Gene = factor(Gene, levels = unique(Gene)))
  
  return(list(overlapFeatTab = summSigFeats, sigFeatTab1 = sigFeats1, sigFeatTab2 = sigFeats2))
}
```

# Plasma Proteomics

```{r}
# Load preprocessed data
proPlasma_DIA <- readRDS('./data/AG_Krijgsveld/proPlasmaNorm_DIA.rds')
proPlasma_DDA <- readRDS('./data/AG_Krijgsveld/proPlasmaNorm.rds')
new_proPlasma_DIA <- readRDS('./data/AG_Krijgsveld/new_proPlasmaNorm_DIA.rds')
```

## Two DIA both from AG Krij.

Compute Pearson correlations of all common features between Plasma Proteomics datasets.
Note that both Baseline and Follow-up samples were used.\
New DIA (590) vs DIA (421) Plasma Proteomics both from AG Krijgsveld => 387 common features
```{r}
# Compute correlations of common features between two datasets
corrRes <- calcFeatCorr(new_proPlasma_DIA, proPlasma_DIA)

ggplot(corrRes, aes(x=Correlation)) +
  geom_histogram(binwidth = 0.1) +
  scale_x_continuous(breaks = c(seq(-0.25, 1, 0.25))) +
  labs(y = 'Frequency', title = 'Two DIA Proteomics both from AG Krijgsveld') +
  th
```

Display associations of feature recurrence predictive power between Plasma Proteomics datasets\
Two DIA Plasma Proteomics both from AG Krijgsveld (significance level = 0.05)\
**Baseline Plasma**
```{r}
# Prepare protein-gene table for changing protein names to gene names
featInfo <- tibble::as_tibble(rowData(new_proPlasma_DIA), rownames = 'Proteins') %>%
  dplyr::select(Proteins, Genes) %>%
  dplyr::mutate(Proteins = stringr::str_remove(Proteins, ';.*'),
                Genes = stringr::str_remove(Genes, ';.*'))

# Prepare association test results including color and label information
combinedAssoTestRes <- combineFeatAsso(new_proPlasma_DIA, proPlasma_DIA, 'New DIA', 'DIA',
                                       condition = 'Baseline', prot_gene_tbl = featInfo)

ggplot(combinedAssoTestRes, aes(x=-log10(pVal_dat1), y=-log10(pVal_dat2), col=Significance, label=Label)) +
  geom_point(size = 3) +
  scale_color_manual(values = c('grey', 'red', 'darkgreen', 'navy')) +
  geom_text_repel(size = 5, show.legend = F) +
  labs(x = '-log10(pVal) of New DIA', y = '-log10(pVal) of DIA',
       title = 'Two DIA Baseline Plasma Proteomics both from AG Krijgsveld') +
  th
```

## New DIA vs DDA both from AG Krij.

Compute Pearson correlations of all common features. Note that both Baseline and
Follow-up samples were used.\
New DIA (590) vs DDA (435) Plasma Proteomics both from AG Krijgsveld => 354 common features
```{r}
# Compute correlations of common features between two datasets
corrRes <- calcFeatCorr(new_proPlasma_DIA, proPlasma_DDA)

ggplot(corrRes, aes(x=Correlation)) +
  geom_histogram(binwidth = 0.1) +
  scale_x_continuous(breaks = c(seq(-0.4, 1, 0.2))) +
  labs(y = 'Frequency', title = 'New DIA vs DDA Proteomics both from AG Krijgsveld') +
  th
```

Display associations of feature recurrence predictive power\
New DIA vs DDA Plasma Proteomics both from AG Krijgsveld (significance level = 0.05)\
**Baseline Plasma**
```{r}
# Prepare protein-gene table for changing protein names to gene names
featInfo <- tibble::as_tibble(rowData(new_proPlasma_DIA), rownames = 'Proteins') %>%
  dplyr::select(Proteins, Genes) %>%
  dplyr::mutate(Proteins = stringr::str_remove(Proteins, ';.*'),
                Genes = stringr::str_remove(Genes, ';.*'))

# Prepare association test results including color and label information
combinedAssoTestRes <- combineFeatAsso(new_proPlasma_DIA, proPlasma_DDA, 'New DIA', 'DDA',
                                       condition = 'Baseline', prot_gene_tbl = featInfo)

ggplot(combinedAssoTestRes, aes(x=-log10(pVal_dat1), y=-log10(pVal_dat2), col=Significance, label=Label)) +
  geom_point(size = 3) +
  scale_color_manual(values = c('grey', 'red', 'darkgreen', 'navy')) +
  geom_text_repel(size = 5, show.legend = F) +
  labs(x = '-log10(pVal) of New DIA', y = '-log10(pVal) of DDA',
       title = 'New DIA vs DDA Baseline Plasma Proteomics both from AG Krijgsveld') +
  th
```

## DIA vs DDA both from AG Krij.

Compute Pearson correlations of all common features between Plasma Proteomics datasets.
Note that both Baseline and Follow-up samples were used.\
DIA (421) vs DDA (435) Plasma Proteomics both from AG Krijgsveld => 341 common features
```{r}
# Compute correlations of common features between two datasets
corrRes <- calcFeatCorr(proPlasma_DIA, proPlasma_DDA)

ggplot(corrRes, aes(x=Correlation)) +
  geom_histogram(binwidth = 0.1) +
  scale_x_continuous(breaks = c(seq(-0.5, 1, 0.25))) +
  labs(y = 'Frequency', title = 'DIA vs DDA Proteomics both from AG Krijgsveld') +
  th
```

```{r include=F, eval=F}
ggplot(corrRes, aes(x=Correlation)) +
  geom_histogram(binwidth = 0.1) +
  scale_x_continuous(breaks = c(seq(-0.5, 1, 0.25))) +
  labs(y = 'Frequency') +
  th + theme(axis.title = element_text(size = 22),
             axis.text = element_text(size = 20))
ggsave('./output/group_meeting/proPlasma_Kri_DIA_DDA_comparison.png', device = 'png',
       dpi = 400, height = 8, width = 8)
```

Display associations of feature recurrence predictive power between Plasma Proteomics datasets\
DIA vs DDA Plasma Proteomics both from AG Krijgsveld (significance level = 0.05)\
**Baseline Plasma**
```{r}
# Prepare protein-gene table for changing protein names to gene names
featInfo <- tibble::as_tibble(rowData(proPlasma_DIA), rownames = 'Proteins') %>%
  dplyr::select(Proteins, Genes) %>%
  dplyr::mutate(Proteins = stringr::str_remove(Proteins, ';.*'),
                Genes = stringr::str_remove(Genes, ';.*'))

# Prepare association test results including color and label information
combinedAssoTestRes <- combineFeatAsso(proPlasma_DIA, proPlasma_DDA, 'DIA', 'DDA',
                                       condition = 'Baseline', prot_gene_tbl = featInfo)

ggplot(combinedAssoTestRes, aes(x=-log10(pVal_dat1), y=-log10(pVal_dat2), col=Significance, label=Label)) +
  geom_point(size = 3) +
  scale_color_manual(values = c('grey', 'red', 'darkgreen', 'navy')) +
  geom_text_repel(size = 5, show.legend = F) +
  labs(x = '-log10(pVal) of DIA', y = '-log10(pVal) of DDA',
       title = 'DIA vs DDA Baseline Plasma Proteomics both from AG Krijgsveld') +
  th
```

## Short summary

Display summarized information of common significant features between two DIA datasets.
Columns 'pVal1' and 'pVal2' present feature significance from input DIA data1 and
data2. Score is product of -log10(pVal1) and -log10(pVal2) and inDDA indicates whether
features are identified and tested significant in DDA data.\
**Baseline Plasma**
```{r}
# Prepare protein-gene table for changing protein names to gene names
featInfo <- tibble::as_tibble(rowData(new_proPlasma_DIA), rownames = 'Proteins') %>%
  dplyr::select(Proteins, Genes) %>%
  dplyr::mutate(Proteins = stringr::str_remove(Proteins, ';.*'),
                Genes = stringr::str_remove(Genes, ';.*'))

# Pinpoint significant features overlapped across datasets
summSigFeats <- findOverlapSigFeats(proPlasma_DIA, new_proPlasma_DIA, proPlasma_DDA,
                                    condition = 'Baseline', prot_gene_tbl = featInfo)
summSigFeats$overlapFeatTab
```

Visualize top common significant features. Gene name starting with asterisk indicates
that feature is supported by DDA dataset.
```{r}
# Visualize most promising significant features
ggplot(summSigFeats$sigFeatTab1, aes(x=Recurrence, y=Abundance, col=Recurrence, fill=Recurrence)) +
  geom_boxplot(alpha = 0.3, outlier.shape = NA) +
  geom_jitter(position = position_jitter(0.2), size = 2, show.legend = F) +
  scale_color_manual(values=c('#00BFC4', '#F8766D')) +
  scale_fill_manual(values=c('#00BFC4', '#F8766D')) +
  facet_wrap(vars(Gene), scales = 'free') +
  labs(title = 'DIA Baseline Plasma Proteomics (AG Krijgsveld)') +
  th + theme(strip.text = element_text(size = 13, face = 'bold'))

ggplot(summSigFeats$sigFeatTab2, aes(x=Recurrence, y=Abundance, col=Recurrence, fill=Recurrence)) +
  geom_boxplot(alpha = 0.3, outlier.shape = NA) +
  geom_jitter(position = position_jitter(0.2), size = 2, show.legend = F) +
  scale_color_manual(values=c('#00BFC4', '#F8766D')) +
  scale_fill_manual(values=c('#00BFC4', '#F8766D')) +
  facet_wrap(vars(Gene), scales = 'free') +
  labs(title = 'New DIA Baseline Plasma Proteomics (AG Krijgsveld)') +
  th + theme(strip.text = element_text(size = 13, face = 'bold'))
```




# Tissue Proteomics

```{r}
# Load preprocessed data
proTissue_DIA <- readRDS('./data/AG_Krijgsveld/proTissueNorm_DIA.rds')
proTissue_DDA <- readRDS('./data/AG_Krijgsveld/proTissueNorm.rds')
proTissue_DIA_Klin <- readRDS('./data/AG_Klingmuller/proTissueNorm_DIA.rds')
# Extract only Method Development samples
proTissue_DIA_Klin <- proTissue_DIA_Klin[, colnames(proTissue_DIA_Klin) %in% colnames(proTissue_DDA)]
new_proTissue_DIA <- readRDS('./data/AG_Krijgsveld/new_proTissueNorm_DIA.rds')
```

## DIA from AG Klin. vs New DIA from Krij.

Compute Pearson correlations of all common features between Tissue Proteomics datasets.
Note that both Tumor and Normal samples were used.\
DIA Tissue Proteomics from AG Klingmüller (7693) vs New DIA Tissue Proteomics from
AG Krijgsveld (6065) => 5763 common features
```{r}
# Compute correlations of common features between two datasets
corrRes <- calcFeatCorr(proTissue_DIA_Klin, new_proTissue_DIA)

ggplot(corrRes, aes(x=Correlation)) +
  geom_histogram(binwidth = 0.1) +
  scale_x_continuous(breaks = c(seq(-0.5, 1, 0.25))) +
  labs(y = 'Frequency', title = 'DIA Proteomics from AG Klingmüller vs New DIA from AG Krijgsveld') +
  th
```

Display associations of feature recurrence predictive power between Tissue Proteomics datasets\
DIA Tissue Proteomics from AG Klingmüller vs New DIA Tissue Proteomics from AG Krijgsveld
(significance level = 0.05)\
**Tumor Tissue**
```{r}
# Prepare protein-gene table for changing protein names to gene names
featInfo <- tibble::as_tibble(rowData(new_proTissue_DIA), rownames = 'Proteins') %>%
  dplyr::select(Proteins, Genes) %>%
  dplyr::mutate(Proteins = stringr::str_remove(Proteins, ';.*'),
                Genes = stringr::str_remove(Genes, ';.*'))

# Prepare association test results including color and label information
combinedAssoTestRes <- combineFeatAsso(proTissue_DIA_Klin, new_proTissue_DIA, 'DIA (Klin.)', 'DIA (Krij.)',
                                       condition = 'Tumor', prot_gene_tbl = featInfo)

ggplot(combinedAssoTestRes, aes(x=-log10(pVal_dat1), y=-log10(pVal_dat2), col=Significance, label=Label)) +
  geom_point(size = 3) +
  scale_color_manual(values = c('grey', 'red', 'darkgreen', 'navy')) +
  geom_text_repel(size = 5, show.legend = F) +
  labs(x = '-log10(pVal) of DIA (Klin.)', y = '-log10(pVal) of DIA (Krij.)',
       title = 'DIA Tumor Tissue Proteomics from AG Klingmüller vs New DIA from AG Krijgsveld') +
  th
```

**Normal Tissue**
```{r}
# Prepare protein-gene table for changing protein names to gene names
featInfo <- tibble::as_tibble(rowData(new_proTissue_DIA), rownames = 'Proteins') %>%
  dplyr::select(Proteins, Genes) %>%
  dplyr::mutate(Proteins = stringr::str_remove(Proteins, ';.*'),
                Genes = stringr::str_remove(Genes, ';.*'))

# Prepare association test results including color and label information
combinedAssoTestRes <- combineFeatAsso(proTissue_DIA_Klin, new_proTissue_DIA, 'DIA (Klin.)', 'DIA (Krij.)',
                                       condition = 'Normal', prot_gene_tbl = featInfo)

ggplot(combinedAssoTestRes, aes(x=-log10(pVal_dat1), y=-log10(pVal_dat2), col=Significance, label=Label)) +
  geom_point(size = 2) +
  scale_color_manual(values = c('grey', 'red', 'darkgreen', 'navy')) +
  geom_text_repel(size = 4, show.legend = F) +
  labs(x = '-log10(pVal) of DIA (Klin.)', y = '-log10(pVal) of DIA (Krij.)',
       title = 'DIA Normal Tissue Proteomics from AG Klingmüller vs New DIA from AG Krijgsveld') +
  th
```

Compare PCs learned from two DIA Normal Tissue Proteomics
```{r}
# AG Klin.
# Subset normal samples
smpNormalIdx <- which(colData(proTissue_DIA_Klin)$Condition == 'Normal')
proNormal_Klin <- proTissue_DIA_Klin[, smpNormalIdx]
# Perform analysis (PC1 and PC7)
proNormalRes_Klin <- doSOA(proNormal_Klin, meta_var = 'Recurrence', pca_method = 'ppca', num_PCs = 16)

# AG Krij.
# Subset normal samples
smpNormalIdx <- which(colData(new_proTissue_DIA)$Condition == 'Normal')
proNormal_Krij <- new_proTissue_DIA[, smpNormalIdx]
# Perform analysis
proNormalRes_Krij <- doSOA(proNormal_Krij, meta_var = 'Recurrence', pca_method = 'ppca', num_PCs = 18)

# Two DIA Normal Tissue Proteomics
proNormalPCTab_Klin <- proNormalRes_Klin$pcTab %>%
  dplyr::select(Sample, PC1, PC7, Recurrence)
proNormalPCTab_Krij <- proNormalRes_Krij$pcTab %>%
  dplyr::select(Sample, PC15)
combinedTab <- dplyr::left_join(proNormalPCTab_Klin, proNormalPCTab_Krij, by = 'Sample')

ggplot(combinedTab, aes(x=PC15, y=PC1)) +
  geom_point(aes(col=Recurrence), size = 4) +
  scale_color_manual(values=c('#00BFC4', '#F8766D')) +
  scale_fill_manual(values=c('#00BFC4', '#F8766D')) +
  ggpubr::stat_cor(aes(label=after_stat(r.label)), method = 'pearson', size = 7) +
  labs(x = 'PC15 (AG Krijgsveld)', y = 'PC1 (AG Klingmüller)', title = 'DIA Normal Tissue Proteomics') +
  th

ggplot(combinedTab, aes(x=PC15, y=PC7)) +
  geom_point(aes(col=Recurrence), size = 4) +
  scale_color_manual(values=c('#00BFC4', '#F8766D')) +
  scale_fill_manual(values=c('#00BFC4', '#F8766D')) +
  ggpubr::stat_cor(aes(label=after_stat(r.label)), method = 'pearson', size = 7) +
  labs(x = 'PC15 (AG Krijgsveld)', y = 'PC7 (AG Klingmüller)', title = 'DIA Normal Tissue Proteomics') +
  th
```
=> These two DIA Normal Tissue Proteomics datasets are relatively powerful in terms
of predicting patient cancer recurrences, especially AG Klingmüller one. However,
significant recurrence-related PCs learned from them are not correlated. Data reproducibility?

## DIA from AG Klin. vs DDA from Krij.

Compute Pearson correlations of all common features. Note that both Tumor and Normal
samples were used.\
DIA Tissue Proteomics from AG Klingmüller (7693) vs DDA Tissue Proteomics from AG
Krijgsveld (5193) => 4955 common features
```{r}
# Compute correlations of common features between two datasets
corrRes <- calcFeatCorr(proTissue_DIA_Klin, proTissue_DDA)

ggplot(corrRes, aes(x=Correlation)) +
  geom_histogram(binwidth = 0.1) +
  scale_x_continuous(breaks = c(seq(-0.5, 1, 0.25))) +
  labs(y = 'Frequency', title = 'DIA Proteomics from AG Klingmüller vs DDA from AG Krijgsveld') +
  th
```

Display associations of feature recurrence predictive power\
DIA Tissue Proteomics from AG Klingmüller vs DDA Tissue Proteomics from AG Krijgsveld
(significance level = 0.05)\
**Tumor Tissue**
```{r}
# Prepare protein-gene table for changing protein names to gene names
featInfo <- tibble::as_tibble(rowData(proTissue_DDA), rownames = 'Proteins') %>%
  dplyr::select(Proteins, PG.Genes) %>%
  dplyr::rename(Genes = PG.Genes) %>%
  dplyr::mutate(Proteins = stringr::str_remove(Proteins, ';.*'),
                Genes = stringr::str_remove(Genes, ';.*'))

# Prepare association test results including color and label information
combinedAssoTestRes <- combineFeatAsso(proTissue_DIA_Klin, proTissue_DDA, 'DIA (Klin.)', 'DDA (Krij.)',
                                       condition = 'Tumor', prot_gene_tbl = featInfo)

ggplot(combinedAssoTestRes, aes(x=-log10(pVal_dat1), y=-log10(pVal_dat2), col=Significance, label=Label)) +
  geom_point(size = 3) +
  scale_color_manual(values = c('grey', 'red', 'darkgreen', 'navy')) +
  geom_text_repel(size = 5, show.legend = F) +
  labs(x = '-log10(pVal) of DIA (Klin.)', y = '-log10(pVal) of DDA (Krij.)',
       title = 'DIA Tumor Tissue Proteomics from AG Klingmüller vs DDA from AG Krijgsveld') +
  th
```

**Normal Tissue**
```{r}
# Prepare protein-gene table for changing protein names to gene names
featInfo <- tibble::as_tibble(rowData(proTissue_DDA), rownames = 'Proteins') %>%
  dplyr::select(Proteins, PG.Genes) %>%
  dplyr::rename(Genes = PG.Genes) %>%
  dplyr::mutate(Proteins = stringr::str_remove(Proteins, ';.*'),
                Genes = stringr::str_remove(Genes, ';.*'))

# Prepare association test results including color and label information
combinedAssoTestRes <- combineFeatAsso(proTissue_DIA_Klin, proTissue_DDA, 'DIA (Klin.)', 'DDA (Krij.)',
                                       condition = 'Normal', prot_gene_tbl = featInfo)

ggplot(combinedAssoTestRes, aes(x=-log10(pVal_dat1), y=-log10(pVal_dat2), col=Significance, label=Label)) +
  geom_point(size = 3) +
  scale_color_manual(values = c('grey', 'red', 'darkgreen', 'navy')) +
  geom_text_repel(size = 5, show.legend = F) +
  labs(x = '-log10(pVal) of DIA (Klin.)', y = '-log10(pVal) of DDA (Krij.)',
       title = 'DIA Normal Tissue Proteomics from AG Klingmüller vs DDA from AG Krijgsveld') +
  th
```

## New DIA vs DDA both from AG Krij.

Compute Pearson correlations of all common features. Note that both Tumor and Normal
samples were used.\
New DIA (6065) vs DDA (5193) Tissue Proteomics both from AG Krijgsveld => 4693 common features
```{r}
# Compute correlations of common features between two datasets
corrRes <- calcFeatCorr(new_proTissue_DIA, proTissue_DDA)

ggplot(corrRes, aes(x=Correlation)) +
  geom_histogram(binwidth = 0.1) +
  scale_x_continuous(breaks = c(seq(-0.5, 1, 0.25))) +
  labs(y = 'Frequency', title = 'New DIA Proteomics vs DDA both from AG Krijgsveld') +
  th
```

Display associations of feature recurrence predictive power\
New DIA vs DDA Tissue Proteomics both from AG Krijgsveld (significance level = 0.05)\
**Tumor Tissue**
```{r}
# Prepare protein-gene table for changing protein names to gene names
featInfo <- tibble::as_tibble(rowData(new_proTissue_DIA), rownames = 'Proteins') %>%
  dplyr::select(Proteins, Genes) %>%
  dplyr::mutate(Proteins = stringr::str_remove(Proteins, ';.*'),
                Genes = stringr::str_remove(Genes, ';.*'))

# Prepare association test results including color and label information
combinedAssoTestRes <- combineFeatAsso(proTissue_DIA_Klin, proTissue_DDA, 'DIA', 'DDA',
                                       condition = 'Tumor', prot_gene_tbl = featInfo)

ggplot(combinedAssoTestRes, aes(x=-log10(pVal_dat1), y=-log10(pVal_dat2), col=Significance, label=Label)) +
  geom_point(size = 3) +
  scale_color_manual(values = c('grey', 'red', 'darkgreen', 'navy')) +
  geom_text_repel(size = 5, show.legend = F) +
  labs(x = '-log10(pVal) of DIA', y = '-log10(pVal) of DDA',
       title = 'New DIA vs DDA Tumor Tissue Proteomics both from AG Krijgsveld') +
  th
```

**Normal Tissue**
```{r}
# Prepare protein-gene table for changing protein names to gene names
featInfo <- tibble::as_tibble(rowData(new_proTissue_DIA), rownames = 'Proteins') %>%
  dplyr::select(Proteins, Genes) %>%
  dplyr::mutate(Proteins = stringr::str_remove(Proteins, ';.*'),
                Genes = stringr::str_remove(Genes, ';.*'))

# Prepare association test results including color and label information
combinedAssoTestRes <- combineFeatAsso(proTissue_DIA_Klin, proTissue_DDA, 'DIA', 'DDA',
                                       condition = 'Normal', prot_gene_tbl = featInfo)

ggplot(combinedAssoTestRes, aes(x=-log10(pVal_dat1), y=-log10(pVal_dat2), col=Significance, label=Label)) +
  geom_point(size = 3) +
  scale_color_manual(values = c('grey', 'red', 'darkgreen', 'navy')) +
  geom_text_repel(size = 5, show.legend = F) +
  labs(x = '-log10(pVal) of DIA', y = '-log10(pVal) of DDA',
       title = 'DIA vs DDA Normal Tissue Proteomics both from AG Krijgsveld') +
  th
```

## Short summary

Display summarized information of common significant features between two DIA datasets.
Columns 'pVal1' and 'pVal2' present feature significance from input DIA data1 and
data2. Score is product of -log10(pVal1) and -log10(pVal2) and inDDA indicates whether
features are identified and tested significant in DDA data.\
**Tumor Tissue**
```{r}
# Prepare protein-gene table for changing protein names to gene names
featInfo <- tibble::as_tibble(rowData(new_proTissue_DIA), rownames = 'Proteins') %>%
  dplyr::select(Proteins, Genes) %>%
  dplyr::mutate(Proteins = stringr::str_remove(Proteins, ';.*'),
                Genes = stringr::str_remove(Genes, ';.*'))

# Pinpoint significant features overlapped across datasets
summSigFeats <- findOverlapSigFeats(proTissue_DIA_Klin, new_proTissue_DIA, proTissue_DDA,
                                    condition = 'Tumor', prot_gene_tbl = featInfo)
summSigFeats$overlapFeatTab
```

Visualize top common significant features. Gene name starting with asterisk indicates
that feature is supported by DDA dataset.
```{r}
# Visualize most promising significant features
ggplot(summSigFeats$sigFeatTab1, aes(x=Recurrence, y=Abundance, col=Recurrence, fill=Recurrence)) +
  geom_boxplot(alpha = 0.3, outlier.shape = NA) +
  geom_jitter(position = position_jitter(0.2), size = 2, show.legend = F) +
  scale_color_manual(values=c('#00BFC4', '#F8766D')) +
  scale_fill_manual(values=c('#00BFC4', '#F8766D')) +
  facet_wrap(vars(Gene), scales = 'free', nrow = 2) +
  labs(title = 'DIA Tumor Tissue Proteomics (AG Klingmüller)') +
  th + theme(strip.text = element_text(size = 13, face = 'bold'))

ggplot(summSigFeats$sigFeatTab2, aes(x=Recurrence, y=Abundance, col=Recurrence, fill=Recurrence)) +
  geom_boxplot(alpha = 0.3, outlier.shape = NA) +
  geom_jitter(position = position_jitter(0.2), size = 2, show.legend = F) +
  scale_color_manual(values=c('#00BFC4', '#F8766D')) +
  scale_fill_manual(values=c('#00BFC4', '#F8766D')) +
  facet_wrap(vars(Gene), scales = 'free', nrow = 2) +
  labs(title = 'New DIA Tumor Tissue Proteomics (AG Krijgsveld)') +
  th + theme(strip.text = element_text(size = 13, face = 'bold'))
```

Display summarized information of common significant features between two DIA datasets\
**Normal Tissue**
```{r}
# Prepare protein-gene table for changing protein names to gene names
featInfo <- tibble::as_tibble(rowData(new_proTissue_DIA), rownames = 'Proteins') %>%
  dplyr::select(Proteins, Genes) %>%
  dplyr::mutate(Proteins = stringr::str_remove(Proteins, ';.*'),
                Genes = stringr::str_remove(Genes, ';.*'))

# Pinpoint significant features overlapped across datasets
summSigFeats <- findOverlapSigFeats(proTissue_DIA_Klin, new_proTissue_DIA, proTissue_DDA,
                                    condition = 'Normal', prot_gene_tbl = featInfo)
summSigFeats$overlapFeatTab
```

Visualize top common significant features. Gene name starting with asterisk indicates
that feature is supported by DDA dataset.
```{r}
# Extract top features
sigFeats <- summSigFeats$overlapFeatTab$Protein[1:6]
sigFeatTab1 <- dplyr::filter(summSigFeats$sigFeatTab1, Protein %in% sigFeats)
sigFeatTab2 <- dplyr::filter(summSigFeats$sigFeatTab2, Protein %in% sigFeats)

# Visualize most promising significant features
ggplot(sigFeatTab1, aes(x=Recurrence, y=Abundance, col=Recurrence, fill=Recurrence)) +
  geom_boxplot(alpha = 0.3, outlier.shape = NA) +
  geom_jitter(position = position_jitter(0.2), size = 2, show.legend = F) +
  scale_color_manual(values=c('#00BFC4', '#F8766D')) +
  scale_fill_manual(values=c('#00BFC4', '#F8766D')) +
  facet_wrap(vars(Gene), scales = 'free') +
  labs(title = 'DIA Tumor Tissue Proteomics (AG Klingmüller)') +
  th + theme(strip.text = element_text(size = 13, face = 'bold'))

ggplot(sigFeatTab2, aes(x=Recurrence, y=Abundance, col=Recurrence, fill=Recurrence)) +
  geom_boxplot(alpha = 0.3, outlier.shape = NA) +
  geom_jitter(position = position_jitter(0.2), size = 2, show.legend = F) +
  scale_color_manual(values=c('#00BFC4', '#F8766D')) +
  scale_fill_manual(values=c('#00BFC4', '#F8766D')) +
  facet_wrap(vars(Gene), scales = 'free') +
  labs(title = 'New DIA Tumor Tissue Proteomics (AG Krijgsveld)') +
  th + theme(strip.text = element_text(size = 13, face = 'bold'))
```




## DIA from AG Klin. vs DIA from Krij.
<font size=4> **Old DIA Tissue Proteomics from AG Krijgsveld got bad data quality.** </font>

Compute Pearson correlations of all common features. Note that both Tumor and Normal
samples were used.\
DIA Tissue Proteomics from AG Klingmüller (7693) vs DIA Tissue Proteomics from AG
Krijgsveld (5057) => 4893 common features
```{r}
# Compute correlations of common features between two datasets
corrRes <- calcFeatCorr(proTissue_DIA_Klin, proTissue_DIA)

ggplot(corrRes, aes(x=Correlation)) +
  geom_histogram(binwidth = 0.1) +
  scale_x_continuous(breaks = c(seq(-0.8, 0.6, 0.2))) +
  labs(y = 'Frequency', title = 'DIA Proteomics from AG Klingmüller vs AG Krijgsveld') +
  th
```

## DIA vs DDA both from AG Krij.
<font size=4> **Old DIA Tissue Proteomics from AG Krijgsveld got bad data quality.** </font>

Compute Pearson correlations of all common features. Note that both Tumor and Normal
samples were used.\
DIA (5057) vs DDA (5193) Tissue Proteomics both from AG Krijgsveld => 4358 common features
```{r}
# Compute correlations of common features between two datasets
corrRes <- calcFeatCorr(proTissue_DIA, proTissue_DDA)

ggplot(corrRes, aes(x=Correlation)) +
  geom_histogram(binwidth = 0.1) +
  scale_x_continuous(breaks = c(-0.6, -0.4, -0.2, 0, 0.2, 0.4, 0.6)) +
  labs(y = 'Frequency', title = 'DIA vs DDA Tissue Proteomics both from AG Krijgsveld') +
  th
```

```{r include=F, eval=F}
ggplot(corrRes, aes(x=Correlation)) +
  geom_histogram(binwidth = 0.1) +
  scale_x_continuous(breaks = c(seq(-0.75, 0.65, 0.25))) +
  labs(y = 'Frequency') +
  th + theme(axis.title = element_text(size = 22),
             axis.text = element_text(size = 20))
ggsave('./output/group_meeting/proTissue_Kri_DIA_DDA_comparison.png', device = 'png',
       dpi = 400, height = 8, width = 8)
```

```{r include=F, eval=F}
# Look into differences in protein-gene tables
# DIA PP vs New DIA PP
dat1 <- proPlasma_DIA
dat2 <- new_proPlasma_DIA

cmnFeats <- intersect(str_remove(rownames(dat1), ';.*'),
                      str_remove(rownames(dat2), ';.*'))
anno1 <- as_tibble(rowData(dat1), rownames = 'Proteins') %>%
  dplyr::select(Proteins, Genes) %>% ####
  mutate(Proteins = str_remove(Proteins, ';.*'),
         Genes = str_remove(Genes, ';.*')) %>%
  filter(Proteins %in% cmnFeats) %>%
  arrange(Proteins)
anno2 <- as_tibble(rowData(dat2), rownames = 'Proteins') %>%
  dplyr::select(Proteins, Genes) %>% ####
  mutate(Proteins = str_remove(Proteins, ';.*'),
         Genes = str_remove(Genes, ';.*')) %>%
  filter(Proteins %in% cmnFeats) %>%
  arrange(Proteins)
if(identical(anno1$Proteins, anno2$Proteins)) {
  diffAnno <- left_join(anno1, anno2, by = 'Proteins') %>%
    filter(Genes.x != Genes.y)
}


# DDA PP vs New DIA PP
dat1 <- proPlasma_DDA
dat2 <- new_proPlasma_DIA

cmnFeats <- intersect(str_remove(rownames(dat1), ';.*'),
                      str_remove(rownames(dat2), ';.*'))
anno1 <- as_tibble(rowData(dat1), rownames = 'Proteins') %>%
  dplyr::rename(Genes = PG.Genes) %>% ####
  mutate(Proteins = str_remove(Proteins, ';.*'),
         Genes = str_remove(Genes, ';.*')) %>%
  filter(Proteins %in% cmnFeats) %>%
  arrange(Proteins)
anno2 <- as_tibble(rowData(dat2), rownames = 'Proteins') %>%
  dplyr::select(Proteins, Genes) %>% ####
  mutate(Proteins = str_remove(Proteins, ';.*'),
         Genes = str_remove(Genes, ';.*')) %>%
  filter(Proteins %in% cmnFeats) %>%
  arrange(Proteins)
if(identical(anno1$Proteins, anno2$Proteins)) {
  diffAnno <- left_join(anno1, anno2, by = 'Proteins') %>%
    filter(Genes.x != Genes.y)
}




# DIA TP (Klin.) vs New DIA TP (Krij.)
dat1 <- proTissue_DIA_Klin
dat2 <- new_proTissue_DIA

cmnFeats <- intersect(str_remove(rownames(dat1), ';.*'),
                      str_remove(rownames(dat2), ';.*'))
anno1 <- as_tibble(rowData(dat1), rownames = 'Proteins') %>%
  dplyr::rename(Genes = PG.Genes) %>% ####
  mutate(Proteins = str_remove(Proteins, ';.*'),
         Genes = str_remove(Genes, ';.*')) %>%
  filter(Proteins %in% cmnFeats) %>%
  arrange(Proteins)
anno2 <- as_tibble(rowData(dat2), rownames = 'Proteins') %>%
  dplyr::select(Proteins, Genes) %>% ####
  mutate(Proteins = str_remove(Proteins, ';.*'),
         Genes = str_remove(Genes, ';.*')) %>%
  filter(Proteins %in% cmnFeats) %>%
  arrange(Proteins)
if(identical(anno1$Proteins, anno2$Proteins)) {
  diffAnno <- left_join(anno1, anno2, by = 'Proteins') %>%
    filter(Genes.x != Genes.y)
}


# IA TP (Klin.) vs DDA TP (Krij.)
dat1 <- proTissue_DIA_Klin
dat2 <- proTissue_DDA

cmnFeats <- intersect(str_remove(rownames(dat1), ';.*'),
                      str_remove(rownames(dat2), ';.*'))
anno1 <- as_tibble(rowData(dat1), rownames = 'Proteins') %>%
  dplyr::rename(Genes = PG.Genes) %>% ####
  mutate(Proteins = str_remove(Proteins, ';.*'),
         Genes = str_remove(Genes, ';.*')) %>%
  filter(Proteins %in% cmnFeats) %>%
  arrange(Proteins)
anno2 <- as_tibble(rowData(dat2), rownames = 'Proteins') %>%
  dplyr::rename(Genes = PG.Genes) %>% ####
  mutate(Proteins = str_remove(Proteins, ';.*'),
         Genes = str_remove(Genes, ';.*')) %>%
  filter(Proteins %in% cmnFeats) %>%
  arrange(Proteins)
if(identical(anno1$Proteins, anno2$Proteins)) {
  diffAnno <- left_join(anno1, anno2, by = 'Proteins') %>%
    filter(Genes.x != Genes.y)
}
```
